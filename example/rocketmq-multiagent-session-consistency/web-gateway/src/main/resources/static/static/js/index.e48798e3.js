(()=>{"use strict";var e,t,r,n,s,o,a={6919(e,t,r){var n=r(4848),s=r(6540),o=r(5338),a=r(4795),l=r(8884),c=r(7181),i=r(1198);r(1890);var u=r(4614),d=r(8397),m=r(1081),f=r(2930),h=r(3535),g=r(4718),p=r(400),y=r(8032),b=r(1166),x=r(9033);let S="http://localhost:9090,http://localhost:9191,http://localhost:9292".split(",").filter(Boolean),v=e=>{let t=e?S.filter(t=>t!==e):S;return 0===t.length?S[0]||"default-node":t[Math.floor(Math.random()*t.length)]},j=function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],r=S.indexOf(e);return -1===r?e:t?`节点${r+1}`:`Node ${r+1}`},w="rocketmq",A=(e,t)=>t?new URL(e,t):new URL(e,window.location.origin),k=async e=>({sessionId:"undefined"!=typeof crypto&&"function"==typeof crypto.randomUUID?crypto.randomUUID():"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)),serverNode:e,createdAt:Date.now()}),C=async function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:w;try{let n=A("/closeStream",e);n.searchParams.set("userId",r),n.searchParams.set("sessionId",t),console.log(`[CloseStream] ${n.toString()}`);let s=await fetch(n.toString(),{method:"GET"}),o=await s.text();return"true"===o}catch(e){return console.error("[CloseStream] Error:",e),!1}},O=function(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:w,s=arguments.length>4?arguments[4]:void 0,o=arguments.length>5?arguments[5]:void 0,a=arguments.length>6?arguments[6]:void 0,l=new AbortController,c=A("/resubscribeStream",e);return c.searchParams.set("userId",n),c.searchParams.set("sessionId",t),null!==r&&c.searchParams.set("lastOffset",String(r)),console.log(`[ResubscribeStream] ${c.toString()}`),fetch(c.toString(),{method:"GET",headers:{Accept:"text/event-stream","Cache-Control":"no-cache"},signal:l.signal}).then(async e=>{var t;if(!e.ok)throw Error(`HTTP error! status: ${e.status}`);let r=null==(t=e.body)?void 0:t.getReader();if(!r)throw Error("No response body");let n=new TextDecoder,o="",l=e=>{for(let t of e.split("\n"))if(t.startsWith("data:")){let e=t.slice(5);if(e)try{let t=JSON.parse(e);null==s||s(t)}catch(t){console.warn("[ResubscribeStream] Failed to parse JSON:",e,t)}}};for(;;){let{done:e,value:t}=await r.read();if(e){o.trim()&&l(o),null==a||a();break}let s=(o+=n.decode(t,{stream:!0})).indexOf("\n\n");for(;-1!==s;){let e=o.substring(0,s);o=o.substring(s+2),l(e),s=o.indexOf("\n\n")}}}).catch(e=>{"AbortError"!==e.name&&(console.error("[ResubscribeStream] Error:",e),null==o||o(e))}),l},R=function(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:w,s=arguments.length>4?arguments[4]:void 0,o=arguments.length>5?arguments[5]:void 0,a=arguments.length>6?arguments[6]:void 0,l=new AbortController,c=A("/stream",e);return c.searchParams.set("question",r),c.searchParams.set("userId",n),c.searchParams.set("sessionId",t),console.log(`[StreamChat] ${c.toString()}`),fetch(c.toString(),{method:"GET",headers:{Accept:"text/event-stream","Cache-Control":"no-cache"},signal:l.signal}).then(async e=>{var t;if(!e.ok)throw Error(`HTTP error! status: ${e.status}`);let r=null==(t=e.body)?void 0:t.getReader();if(!r)throw Error("No response body");let n=new TextDecoder,o="",l=e=>{for(let t of e.split("\n"))if(t.startsWith("data:")){let e=t.slice(5);if(e)try{let t=JSON.parse(e);null==s||s(t)}catch(t){console.warn("[StreamChat] Failed to parse JSON:",e,t)}}};for(;;){let{done:e,value:t}=await r.read();if(e){o.trim()&&l(o),null==a||a();break}let s=(o+=n.decode(t,{stream:!0})).indexOf("\n\n");for(;-1!==s;){let e=o.substring(0,s);o=o.substring(s+2),l(e),s=o.indexOf("\n\n")}}}).catch(e=>{"AbortError"!==e.name&&(console.error("[StreamChat] Error:",e),null==o||o(e))}),l},{Title:$,Link:E}=d.A,N={assistant:{placement:"start",contentRender:e=>(0,n.jsx)(i.A,{className:"x-markdown-light",content:e})},user:{placement:"end"},system:{placement:"start",variant:"borderless",styles:{content:{background:"#f5f5f5",color:"#666",fontSize:12}}}};var P=r(9821);let T=document.getElementById("root");T&&o.createRoot(T).render((0,n.jsx)(s.StrictMode,{children:(0,n.jsx)(P.Ay,{theme:{token:{}},children:(0,n.jsx)(()=>{let[e,t]=s.useState(""),[r,o]=s.useState(!0),d={placeholder:r?"请输入内容，按下 Enter 发送消息":"Please enter content and press Enter to send message",requestFailed:r?"请求失败，请重试！":"Request failed, please try again!",retry:r?"重试":"Retry",createSessionFailed:r?"创建会话失败，请重试":"Failed to create session",selectSessionFirst:r?"请先选择一个会话":"Please select a session first",emptyState:r?"点击左侧「新对话」开始聊天":'Click "New Chat" to start',pageTitle:r?"体验通过RocketMQ解决会话异步通知和状态连续性的问题":"Experience RocketMQ solving async notification and state continuity",experienceTitle:r?"体验过程":"Experience Process",experienceStep1:r?"创建会话，会话长连接会随机连接到服务端任意一个节点。":"Create a session, the session will randomly connect to any server node.",experienceStep2:r?"在大模型返回结果的过程中，重连会话，体验会话响应结果的连续性。":"During model response, reconnect to experience response continuity.",reconnect:r?"重连会话":"Reconnect",downloadCode:r?"点此下载解决方案代码":"Download Solution Code",learnMore:r?"点此了解RocketMQ LiteTopic详解介绍":"Learn about RocketMQ LiteTopic",sessionCreated:(e,t,n)=>r?`系统信息：当前会话ID为${e}，连接到服务${j(t,!0)}，时间：${n}。`:`System Info: Session ID is ${e}, connected to ${j(t,!1)}, time: ${n}.`,reconnecting:(e,t,n)=>r?`系统信息：从${j(e,!0)}切换到${j(t,!0)}发起重新订阅，时间：${n}。`:`System Info: Switching from ${j(e,!1)} to ${j(t,!1)} for resubscription, time: ${n}.`},[S,w]=s.useState(()=>v()),A=(0,s.useRef)(""),P=(0,s.useRef)(null),T=(0,s.useRef)(null),{addConversation:I,activeConversationKey:D,setActiveConversationKey:_}=(0,u.A)({defaultConversations:[],defaultActiveConversationKey:void 0}),[q,M]=s.useState(!1),[F,U]=s.useState(!1),[L,z]=s.useState(!1),[J,Q]=s.useState(!1),G=(0,s.useRef)(!1),B=(0,s.useRef)(-1),[H,W]=s.useState([]),K=()=>new Date().toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}),V=e=>{W(t=>[...t,{id:`system-${Date.now()}`,message:{role:"system",content:e},status:"success"}])},X=async()=>{M(!0);try{let{sessionId:e,serverNode:t}=await k(S);A.current=e,I({key:e,label:e}),_(e),W([{id:`system-${Date.now()}`,message:{role:"system",content:d.sessionCreated(e,t,K())},status:"success"}])}catch(e){console.error("[CreateSession] Error:",e),m.Ay.error(d.createSessionFailed)}finally{M(!1)}},Y=(0,s.useRef)(""),Z=e=>{if(!A.current||!S)return void m.Ay.warning(d.selectSessionFirst);Y.current="";let t=`user-${Date.now()}`,r=`assistant-${Date.now()}`;W(n=>[...n,{id:t,message:{role:"user",content:e},status:"success"},{id:r,message:{role:"assistant",content:""},status:"loading"}]),z(!0),G.current=!1,Q(!0),B.current=-1,P.current=R(S,A.current,e,"rocketmq",e=>{G.current||(G.current=!0,Q(!1)),B.current=e.offset,Y.current+=e.content;let t=Y.current;W(e=>e.map(e=>e.id===r?{...e,message:{...e.message,content:t}}:e))},e=>{console.error("[StreamChat] Error:",e),Q(!1),W(e=>e.map(e=>e.id===r?{...e,message:{...e.message,content:Y.current||d.requestFailed},status:"error"}:e)),z(!1)},()=>{Q(!1),W(e=>e.map(e=>e.id===r?{...e,message:{...e.message,content:Y.current},status:"success"}:e)),z(!1),P.current=null})},ee=async()=>{if(!D||!A.current)return void m.Ay.warning(d.selectSessionFirst);let e=A.current;U(!0);let t=L||J||null!==T.current;T.current&&(T.current.abort(),T.current=null);try{t&&(P.current&&(P.current.abort(),P.current=null,z(!1),m.Ay.warning("检测到正在进行对话，已终止当前请求")),await C(S,e)||console.warn("[Reconnect] closeStream returned false, continuing anyway"));let r=v(S);if(w(r),V(d.reconnecting(S,r,K())),t){let t=B.current;console.log(`[Reconnect] Using saved offset: ${t}`),G.current=!1,Q(!0),T.current=O(r,e,t>=0?t:null,"rocketmq",e=>{e.offset>t?(G.current||(G.current=!0,Q(!1)),B.current=e.offset,W(t=>{let r=-1;for(let e=t.length-1;e>=0;e--){if("assistant"===t[e].message.role){r=e;break}if("user"===t[e].message.role)break}return -1!==r&&"loading"===t[r].status?t.map((t,n)=>n===r?{...t,message:{...t.message,content:t.message.content+e.content}}:t):t})):B.current=e.offset},e=>{console.error("[ResubscribeStream] Error:",e),Q(!1),T.current=null,V(`系统信息：重新订阅过程中发生错误，时间：${K()}。`)},()=>{console.log("[ResubscribeStream] Complete"),Q(!1),T.current=null})}m.Ay.success("重连成功")}catch(e){console.error("[Reconnect] Error:",e),V(`系统信息：重连失败，请稍后重试，时间：${K()}。`),m.Ay.error("重连失败，请稍后重试"),w(S)}finally{U(!1)}};return(0,s.useEffect)(()=>{M(!0),setTimeout(()=>{X(),M(!1)},1e3)},[]),(0,n.jsxs)(f.A,{vertical:!0,className:"app-container",children:[(0,n.jsxs)(f.A,{vertical:!0,gap:"middle",className:"app-header",children:[(0,n.jsxs)(f.A,{justify:"space-between",align:"center",children:[(0,n.jsx)($,{level:3,children:d.pageTitle}),(0,n.jsx)(f.A,{align:"center",gap:"small",children:(0,n.jsx)(h.A,{checked:r,onChange:o,checkedChildren:"中",unCheckedChildren:"EN"})})]}),(0,n.jsx)(g.A,{type:"info",showIcon:!0,title:(0,n.jsx)("div",{className:"alert-title",children:d.experienceTitle}),description:(0,n.jsxs)("ol",{className:"alert-steps",children:[(0,n.jsx)("li",{children:d.experienceStep1}),(0,n.jsx)("li",{children:d.experienceStep2})]})}),(0,n.jsxs)(f.A,{gap:"middle",align:"center",children:[(0,n.jsx)(p.Ay,{type:"primary",onClick:ee,loading:F,disabled:!D||J,children:d.reconnect}),(0,n.jsx)(E,{href:"https://github.com/apache/rocketmq-a2a/tree/main/example/rocketmq-multiagent-session-consistency",target:"_blank",children:d.downloadCode}),(0,n.jsx)(E,{href:"https://help.aliyun.com/zh/apsaramq-for-rocketmq/cloud-message-queue-rocketmq-5-x-series/developer-reference/litetopic",target:"_blank",children:d.learnMore})]})]}),(0,n.jsxs)(f.A,{className:"app-main",children:[(0,n.jsx)(y.A,{spinning:q,fullscreen:!0}),(0,n.jsx)(f.A,{vertical:!0,gap:"middle",className:"app-chat",children:D?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l.A.List,{className:"chat-messages",role:N,items:H.map((e,t)=>{let{id:r,message:s,status:o}=e;return{key:r,role:s.role,loading:"loading"===o&&t===H.length-1&&"assistant"===s.role&&J,status:o,content:s.content,..."assistant"===s.role&&{contentRender:e=>(0,n.jsx)(i.A,{className:"x-markdown-light",content:e})},components:"assistant"===s.role?{footer:(0,n.jsx)(b.A,{title:d.retry,children:(0,n.jsx)(p.Ay,{size:"small",type:"text",icon:(0,n.jsx)(a.A,{}),className:"retry-btn",onClick:()=>(e=>{let t=H.findIndex(t=>t.id===e);if(t<=0)return;let r=H[t-1];(null==r?void 0:r.message.role)==="user"&&(W(e=>e.slice(0,t-1)),Z(r.message.content))})(r)})})}:{}}})}),(0,n.jsx)(c.A,{loading:L||J,value:e,onCancel:()=>{P.current&&(P.current.abort(),P.current=null,z(!1))},onChange:t,placeholder:d.placeholder,onSubmit:e=>{Z(e),t("")},footer:(0,n.jsx)(f.A,{justify:"flex-start",style:{padding:"4px 0"},gap:"small",children:(0,n.jsxs)(x.A,{color:"blue",children:["Session: ",A.current]})})})]}):(0,n.jsx)(f.A,{align:"center",justify:"center",className:"empty-state",children:d.emptyState})})]})]})},{})})}))}},l={};function c(e){var t=l[e];if(void 0!==t)return t.exports;var r=l[e]={exports:{}};return a[e].call(r.exports,r,r.exports,c),r.exports}c.m=a,c.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return c.d(t,{a:t}),t},t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,c.t=function(r,n){if(1&n&&(r=this(r)),8&n||"object"==typeof r&&r&&(4&n&&r.__esModule||16&n&&"function"==typeof r.then))return r;var s=Object.create(null);c.r(s);var o={};e=e||[null,t({}),t([]),t(t)];for(var a=2&n&&r;("object"==typeof a||"function"==typeof a)&&!~e.indexOf(a);a=t(a))Object.getOwnPropertyNames(a).forEach(e=>{o[e]=()=>r[e]});return o.default=()=>r,c.d(s,o),s},c.d=(e,t)=>{for(var r in t)c.o(t,r)&&!c.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),c.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r=[],c.O=(e,t,n,s)=>{if(t){s=s||0;for(var o=r.length;o>0&&r[o-1][2]>s;o--)r[o]=r[o-1];r[o]=[t,n,s];return}for(var a=1/0,o=0;o<r.length;o++){for(var[t,n,s]=r[o],l=!0,i=0;i<t.length;i++)(!1&s||a>=s)&&Object.keys(c.O).every(e=>c.O[e](t[i]))?t.splice(i--,1):(l=!1,s<a&&(a=s));if(l){r.splice(o--,1);var u=n();void 0!==u&&(e=u)}}return e},n={410:0},c.O.j=e=>0===n[e],s=(e,t)=>{var r,s,[o,a,l]=t,i=0;if(o.some(e=>0!==n[e])){for(r in a)c.o(a,r)&&(c.m[r]=a[r]);if(l)var u=l(c)}for(e&&e(t);i<o.length;i++)s=o[i],c.o(n,s)&&n[s]&&n[s][0](),n[s]=0;return c.O(u)},(o=self.webpackChunkrsbuild_project=self.webpackChunkrsbuild_project||[]).forEach(s.bind(null,0)),o.push=s.bind(null,o.push.bind(o));var i=c.O(void 0,["783","512"],()=>c(6919));i=c.O(i)})();